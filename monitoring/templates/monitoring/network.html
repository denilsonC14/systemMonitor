{% extends 'monitoring/base.html' %}

{% block title %}Monitoreo de Red{% endblock %}

{% block header %}Información de Red{% endblock %}

{% block extra_style %}
.network-metrics {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 20px;
}
.metric-box {
    background-color: #f8f9fa;
    border-radius: 8px;
    padding: 15px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
}
.metric-title {
    font-size: 16px;
    font-weight: bold;
    color: #2c3e50;
    margin-bottom: 10px;
}
.metric-value {
    font-size: 24px;
    font-weight: 300;
    color: #3498db;
}
.metric-unit {
    font-size: 14px;
    color: #7f8c8d;
    margin-top: 5px;
}
{% endblock %}

{% block content %}
<div class="card">
    <h2>Estadísticas de Red</h2>
    <p>Información sobre el tráfico de red actual del sistema.</p>
    
    <div class="network-metrics">
        <div class="metric-box">
            <div class="metric-title">Bytes Enviados</div>
            <div class="metric-value">{{ network_info.bytes_sent|filesizeformat }}</div>
            <div class="metric-unit">Total desde el inicio del sistema</div>
        </div>
        
        <div class="metric-box">
            <div class="metric-title">Bytes Recibidos</div>
            <div class="metric-value">{{ network_info.bytes_recv|filesizeformat }}</div>
            <div class="metric-unit">Total desde el inicio del sistema</div>
        </div>
        
        <div class="metric-box">
            <div class="metric-title">Paquetes Enviados</div>
            <div class="metric-value">{{ network_info.packets_sent }}</div>
            <div class="metric-unit">Total de paquetes</div>
        </div>
        
        <div class="metric-box">
            <div class="metric-title">Paquetes Recibidos</div>
            <div class="metric-value">{{ network_info.packets_recv }}</div>
            <div class="metric-unit">Total de paquetes</div>
        </div>
    </div>
</div>

<div class="card">
    <h2>Interpretación</h2>
    <p>Estos valores representan el tráfico acumulado desde que se inició el sistema operativo. Para obtener tasas de transferencia en tiempo real, es necesario tomar muestras en intervalos regulares y calcular la diferencia.</p>
</div>
{% endblock %}
{% block page_scripts %}
<script>
    document.addEventListener('realtimeDataUpdate', function(event) {
        const data = event.detail;
        
        // Actualizar bytes enviados
        document.querySelector('.metric-box:nth-child(1) .metric-value')
            .textContent = formatBytes(data.network_info.bytes_sent);
            
        // Actualizar bytes recibidos
        document.querySelector('.metric-box:nth-child(2) .metric-value')
            .textContent = formatBytes(data.network_info.bytes_recv);
            
        // Actualizar paquetes enviados
        document.querySelector('.metric-box:nth-child(3) .metric-value')
            .textContent = data.network_info.packets_sent;
            
        // Actualizar paquetes recibidos
        document.querySelector('.metric-box:nth-child(4) .metric-value')
            .textContent = data.network_info.packets_recv;
        
        // Añadir indicador de última actualización
        updateLastUpdated(data.timestamp);
    });
    
    // Función para formatear bytes
    function formatBytes(bytes) {
        if (bytes === 0) return '0 Bytes';
        const k = 1024;
        const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB'];
        const i = Math.floor(Math.log(bytes) / Math.log(k));
        return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
    }
    
    // Función para actualizar timestamp
    function updateLastUpdated(timestamp) {
        let lastUpdatedElement = document.getElementById('last-updated');
        if (!lastUpdatedElement) {
            lastUpdatedElement = document.createElement('div');
            lastUpdatedElement.id = 'last-updated';
            lastUpdatedElement.className = 'last-updated';
            document.querySelector('.card').appendChild(lastUpdatedElement);
        }
        lastUpdatedElement.textContent = 'Última actualización: ' + timestamp;
    }
</script>
{% endblock %}
